/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */

plugins {
    id "base"
    id "java"
    id 'de.undercouch.download' version '4.0.4'
}

def homePath = System.properties['user.home']
def launcher = 'libs/IntentLauncher.jar'

task cleanup(type: Delete, group: "ZeroDevelop", description: "Cleans all unnecessary files") {
    delete 'build', 'libs', 'out', 'MyModule.zip', 'ZeroDevelop-SDK.zip'
    followSymlinks = false
}

task zip(type: Zip, group: "ZeroDevelop", description: "Archives project in a zip file") {
    from("$projectDir") {
        exclude "**/.gradle"
        exclude "**/build"
        exclude "**/libs"
        exclude "**/out"
    }
    archiveFileName = "ZeroDevelop-SDK.zip"
}

task getSDK(type: Download, group: "ZeroDevelop", description: "Downloads SDK") {
    src 'https://www.intent.store/zerodevelop/sdk/ZeroDevelop-SDK-1.0.0.jar'
    dest 'libs/ZeroDevelop-SDK-1.0.0.jar'
}

task getLauncher(type: Download, group: "ZeroDevelop", description: "Download Intent Launcher") {
    src 'https://intent.store/intentlauncher/Intent%20Launcher.zip'
    dest 'libs/IntentLauncher.zip'
}

task unzip(type: Copy, group: "ZeroDevelop",) {
    //delete 'libs/IntentLauncher.zip'
    def zipFile = file('libs/IntentLauncher.zip')
    def outputDir = file("libs/")

    from zipTree(zipFile)
    into outputDir
}

task prepLauncher(type: Copy, group: "ZeroDevelop") {
    from('libs/') {
        rename 'Intent Launcher v6.jar', 'IntentLauncher.jar'
    }
    into 'libs'
}

task downloadLibs(group: "ZeroDevelop", description: "Download required Libraries") {
    //delete 'libs' //Make downloads check if fileExists
    dependsOn getSDK
    dependsOn getLauncher
    dependsOn unzip
    dependsOn prepLauncher
}

task setup(group: "ZeroDevelop",) {
    dependsOn downloadLibs
    println 'Starting!'
}

task install(group: "ZeroDevelop",) {
    dependsOn setup
    dependsOn compileJava
    //needs to run gradlew compileJava
    //compiled classes stored at \out\production\ZeroDevelop-SDK\store\intent\zerodevelop
    //if compiled by gradle, check \build\classes\java\main\store\intent\zerodevelop
    //compiled classes need to go to homePath\intentlauncher\ZeroDay\ZeroDevelop
}

task release(type: Zip, group: "ZeroDevelop", description: "Archives compiled files in a zip file") {
    dependsOn install
    from("$projectDir/build/classes/java/main/store/intent/zerodevelop/custom")
    archiveFileName = "MyModule.zip"
    //released file is in build/distributions/MyModule.zip
}

task run(type: Exec, group: "ZeroDevelop",) {
    //https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Exec.html - guide on running external programs
    //This needs to download intent launcher to libs
    dependsOn install
    commandLine 'cmd', '/c', "java -jar $launcher" //change 'cmd' to your shell if using mac/linux
}

// You can use task.dependsOn anotherTask here
defaultTasks 'install'

dependencies {
    implementation files('libs/ZeroDevelop-SDK-1.0.0.jar')
}

sourceSets {
    main {
        java {
            srcDirs = ['store/intent/zerodevelop']
        }
    }
}